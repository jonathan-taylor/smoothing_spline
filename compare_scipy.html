<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Boundary Behavior Comparison: smoothing_spline vs scipy &#8212; smoothing_spline  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Boundary-Behavior-Comparison:-smoothing_spline-vs-scipy">
<h1>Boundary Behavior Comparison: <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> vs <code class="docutils literal notranslate"><span class="pre">scipy</span></code><a class="headerlink" href="#Boundary-Behavior-Comparison:-smoothing_spline-vs-scipy" title="Link to this heading">¶</a></h1>
<p>This document illustrates the differences in boundary behavior and extrapolation between <code class="docutils literal notranslate"><span class="pre">smoothing_spline.SplineFitter</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy.interpolate.make_smoothing_spline</span></code>.</p>
<p>While both methods fit smoothing splines, <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> explicitly implements <strong>natural cubic splines</strong>, which implies that the function should be linear beyond the boundary knots (i.e., the second derivative is zero at the boundaries).</p>
<p>We will demonstrate this by fitting both models to a dataset and observing their predictions outside the range of the training data.</p>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_smoothing_spline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">smoothing_spline</span><span class="w"> </span><span class="kn">import</span> <span class="n">SplineFitter</span>

<span class="c1"># Generate synthetic data</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="c1"># Define extrapolation range (+/- 50% of data range)</span>
<span class="n">x_range</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">x_range</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Fitting-the-Models">
<h2>Fitting the Models<a class="headerlink" href="#Fitting-the-Models" title="Link to this heading">¶</a></h2>
<p>We will fit both models using a similar regularization strength. Note that the parameterization of <span class="math notranslate nohighlight">\(\lambda\)</span> might differ slightly, but we will try to match the degrees of freedom or visual smoothness for a fair qualitative comparison. Here we fix <code class="docutils literal notranslate"><span class="pre">lam</span></code> for <code class="docutils literal notranslate"><span class="pre">make_smoothing_spline</span></code> and use <code class="docutils literal notranslate"><span class="pre">solve_gcv</span></code> or fixed lambda for <code class="docutils literal notranslate"><span class="pre">SplineFitter</span></code>.</p>
<p>For simplicity, let’s fix a lambda value that provides a reasonable smooth fit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit smoothing_spline</span>
<span class="c1"># We explicitly ask for a specific lambda or let GCV find one.</span>
<span class="c1"># Let&#39;s use GCV for smoothing_spline to get a good fit first.</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">SplineFitter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lam_best</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">solve_gcv</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y_ours</span> <span class="o">=</span> <span class="n">fitter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_plot</span><span class="p">)</span>

<span class="c1"># Fit scipy.interpolate.make_smoothing_spline</span>
<span class="c1"># scipy&#39;s lam is roughly related. We&#39;ll try to use a similar value or just pick one that looks good.</span>
<span class="c1"># SciPy documentation says minimizes \sum w_i (y_i - g(x_i))^2 + lam \int g&#39;&#39;(t)^2 dt</span>
<span class="c1"># Our objective is essentially the same.</span>
<span class="c1"># Note: SplineFitter scales x internally to [0, range]. Scipy does not?</span>
<span class="c1"># Let&#39;s just try to match them or show the qualitative difference.</span>
<span class="c1"># We&#39;ll calculate the lambda that scipy would use?</span>
<span class="c1"># Let&#39;s just fit scipy with a specific lambda to ensure smoothness.</span>
<span class="n">lam_scipy</span> <span class="o">=</span> <span class="mf">1e-2</span> <span class="c1"># heuristic</span>
<span class="n">spl_scipy</span> <span class="o">=</span> <span class="n">make_smoothing_spline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="n">lam_scipy</span><span class="p">)</span>
<span class="n">y_scipy</span> <span class="o">=</span> <span class="n">spl_scipy</span><span class="p">(</span><span class="n">x_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Visualization">
<h2>Visualization<a class="headerlink" href="#Visualization" title="Link to this heading">¶</a></h2>
<p>Now we plot the data, the fitted curves within the data range, and the extrapolation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot Data</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Plot smoothing_spline result</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_ours</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;smoothing_spline (Natural)&#39;</span><span class="p">)</span>

<span class="c1"># Plot scipy result</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_scipy</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scipy.interpolate.make_smoothing_spline&#39;</span><span class="p">)</span>

<span class="c1"># Highlight data boundaries</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Extrapolation Behavior: Natural vs. SciPy Spline&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/compare_scipy_5_0.png" src="_images/compare_scipy_5_0.png" />
</div>
</div>
</section>
<section id="Analysis">
<h2>Analysis<a class="headerlink" href="#Analysis" title="Link to this heading">¶</a></h2>
<p>As seen in the plot:</p>
<ol class="arabic simple">
<li><p><strong>``smoothing_spline``</strong>: The blue line becomes perfectly <strong>linear</strong> outside the vertical dashed lines (the data boundaries). This is the defining property of a <strong>natural cubic spline</strong>. The second derivative is zero at the boundary knots, and this zero curvature is maintained during extrapolation.</p></li>
<li><p><strong>``scipy.interpolate.make_smoothing_spline``</strong>: The red dashed line usually exhibits <strong>cubic</strong> extrapolation (it curves away). While <code class="docutils literal notranslate"><span class="pre">make_smoothing_spline</span></code> solves the smoothing spline objective, the returned B-spline object often extrapolates based on the polynomial form of the end segments, which is not necessarily constrained to be linear unless specific boundary knots or coefficients are enforced. In many statistical contexts, the “natural” boundary condition (linear extrapolation) is
preferred to avoid wild oscillations outside the data range.</p></li>
</ol>
<p>This highlights a key feature of the <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> package: it guarantees safe, linear extrapolation by design.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">smoothing_spline</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Smoothing Splines: Theory and Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare_R.html">Comparing <code class="docutils literal notranslate"><span class="pre">smoothing_spline</span></code> with R’s <code class="docutils literal notranslate"><span class="pre">smooth.spline</span></code></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Jonathan Taylor.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/compare_scipy.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>